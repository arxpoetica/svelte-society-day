<div class="video" class:loaded>
	<div bind:this={placeholder}></div>
	<div class="no-click"></div>
</div>

<script>
	export let intersecting
	export let id
	export let volume = 100
	export let start = 0
	export let end = 3000

	// import { muted } from '../../stores/story-store.js'
	import { youtube_ready } from '@society/js/stores.js'

	let placeholder
	let player
	let loaded = false

	$: if (loaded) {
		if (intersecting) {
			player.seekTo(start)
			player.playVideo()
		} else {
			player.pauseVideo()
		}
	}

	$: if ($youtube_ready) {
		player = new YT.Player(placeholder, {
			// height: '390',
			// width: '640',
			videoId: id,
			playerVars: {
				controls: 0,
				loop: 1,
				start,
				end,
				playlist: id,
				disablekb: 1,
				modestbranding: 1,
				showinfo: 0,
				autohide: 1,
				iv_load_policy: 3,
				rel: 0,
				// enablejsapi: 1,
				// origin: 'http://localhost:3000/slides',
			},
			events: {
				onReady,
				// onStateChange: onPlayerStateChange,
			}
		})
	}
	function onReady(event) {
		loaded = true
		player.setVolume(volume)
	}
</script>

<style type="text/scss">
	.video {
		overflow: hidden;
		position: absolute;
		top: 0;
		right: 0;
		bottom: 0;
		left: 0;
		opacity: 0;
		transition: opacity 0.5s ease-in-out;
		&.loaded {
			opacity: 1;
		}
		:global(iframe) {
			border: 0;
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
		}
	}
	.no-click {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}
</style>
