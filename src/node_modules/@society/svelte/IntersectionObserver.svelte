<script>
	export let elem = undefined
	export let intersecting = false
	export let threshold = 0

	import { story_scroll, view_height } from '@society/js/stores.js'

	$: if (elem && $story_scroll > -1) {
		const { top, height } = elem.getBoundingClientRect()
		threshold = 1 - Math.min(Math.max((top + height) / ($view_height + height), 0), 1)
	}

	$: if (elem) {
		const observer = new IntersectionObserver((entries, observer) => {
			intersecting = entries[0].isIntersecting
		}, {
			root: null,
			rootMargin: '-1px 0px -101px 0px',
			threshold:  [0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1],
		})
		observer.observe(elem)
	}
</script>
