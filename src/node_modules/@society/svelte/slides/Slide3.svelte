<IntersectionObserver bind:elem bind:intersecting bind:threshold/>
<div bind:this={elem} class="modal modal-sprite">
	<div class="sticky">
		<div class="panel-fixed panel-fixed-1">
			<div class="panel-clip">
				<div class="panel-content history-early-1" style="transform:scale({1 + (threshold * 0.5)});"></div>
			</div>
			<div class="panel-clip">
				<div class="panel-content history-early-2" style="transform:scale({1 + (threshold * 0.5)})"></div>
			</div>
		</div>
		<div class:fliptwo class="panel-fixed columns panel-fixed-2">
			<div class="panel-clip">
				<div class="panel-content history-later-1" style="transform:scale({1 + (threshold * 0.5)});"></div>
			</div>
			<div class="panel-clip">
				<div class="panel-content history-later-2" style="transform:scale({1 + (threshold * 0.5)});"></div>
			</div>
		</div>
		<div class:flipthree class="panel-fixed panel-fixed-3">
			<div class="panel-clip">
				<div class="panel-content history-modern-1" style="transform:scale({0.7 + (threshold * 0.5)});"></div>
			</div>
			<div class="panel-clip">
				<div class="panel-content history-modern-2" style="transform:scale({0.7 + (threshold * 0.5)});"></div>
			</div>
			<div class="panel-clip">
				<div class="panel-content history-modern-3" style="transform:scale({0.7 + (threshold * 0.5)});"></div>
			</div>
			<div class="panel-clip">
				<div class="panel-content history-modern-4" style="transform:scale({0.7 + (threshold * 0.5)});"></div>
			</div>
		</div>
	</div>
	<div class="content">
		<div class="panel-scroll panel-1">
			<h3>
				Among the oldest type of cave paintings <br>are hand stencils and simple geometric shapes.
			</h3>
			<blockquote class="yellow">
				“This one is magic, because it has lava. And a storm, <br>and chacks (sticks that go up and down in the storm).”
			</blockquote>
		</div>
		<div class="panel-scroll panel-2">
			<div>
				<h3>Raw Materials</h3>
				<ul>
					{#if materials}
						{#each materials as material, index}
							<li style={random_style(threshold, index)}>{material.name}</li>
						{/each}
					{/if}
				</ul>
			</div>
		</div>
		<div class="panel-scroll panel-3">
			<h3>A Myriad of Modern Milestones</h3>
		</div>
	</div>
</div>
<!-- After listening to all these points, here's my perhaps heavy-handed take, ha. Tailwind is today's CSS equivalent of yesterday's jQuery. -->
<!-- It solves a problem "easily," but at the end of the day it's still not really solving an underlying problem: CSS is still just not what it needs to be. -->
<!-- I'm actually (to some degree) surprised to hear myself say that, but once it came out of my mouth, it actually makes a lot of sense. -->
<!-- Basically, styling, animation, and the web on whole is just really hard to work with as a medium. -->
<!-- So funny thing: this conversation just folded very nicely into my talk. -->
<!-- Thanks, ha. -->

<script>
	import { onMount } from 'svelte'
	import { story_scroll, view_height } from '@society/js/stores.js'
	import IntersectionObserver from '@society/svelte/IntersectionObserver.svelte'
	let elem, intersecting, threshold

	$: fliptwo = threshold > 1/3
	$: flipthree = threshold > 2/3

	const materials_pre = ['STONE', 'METAL', 'PLASTER', 'LIME', 'GYPSUM', 'CEMENT', 'BRASS', 'GOLD', 'CLAY', 'WOOD', 'REED', 'LEATHER', 'SHEEPSKIN', 'CLOTH']
	const colors = ['#dae4e9', '#a3c1d0', '#688ea2', '#505050', '#cfcecb', 'white', '#818181']
	let materials
	onMount(() => {
		materials = materials_pre.map(material => {
			return {
				name: material,
				fontsize: random_int(20, 60),
				color: colors[random_int(0, 6)],
				offset: random_int(400, 1200),
			}
		})
	})

	function random_style(threshold, index) {
		const mat = materials[index]
		return `
			font-size: ${mat.fontsize}rem;
			color: ${mat.color};
			transform: translateY(${-700 + (mat.offset * threshold * 2)}rem);
		`
	}
	function random_int(min, max) {
		min = Math.ceil(min)
		max = Math.floor(max)
		return Math.floor(Math.random() * (max - min + 1)) + min
	}
</script>

<style type="text/scss">
	.modal-sprite {
		overflow: visible;
		display: flex;
		background-color: #222;
	}

	.panel-fixed {
		opacity: 0;
		// opacity: 1;
		transition: opacity 0.75s ease-in-out;
		&.fliptwo { opacity: 1; }
		&.flipthree { opacity: 1; }
	}
	.panel-fixed-1 { opacity: 1; }
	.panel-fixed-3 { grid-template-columns: 1fr 1fr; }

	.history-early-1 { background-image: url('/img/slides/history-cave-paintings.jpg'); }
	.history-early-2 { background-image: url('/img/slides/history-son-painting.jpg'); }
	.history-later-1 { background-image: url('/img/slides/history-egyptian-writing.jpg'); }
	.history-later-2 { background-image: url('/img/slides/history-maya-writing.jpg'); }
	.history-modern-1 { background-image: url('/img/slides/history-modern-1.png'); }
	.history-modern-2 { background-image: url('/img/slides/history-modern-2.png'); }
	.history-modern-3 { background-image: url('/img/slides/history-modern-3.png'); }
	.history-modern-4 { background-image: url('/img/slides/history-modern-4.png'); }

	.content {
		overflow: hidden;
	}
	.panel-2 {
		overflow: hidden;
		background-color: #333;
		h3 {
			position: relative;
			padding: 20rem 80rem;
			background-color: rgba(255, 255, 255, 0.75);
			color: black;
			text-transform: uppercase;
			font-weight: $bold;
			z-index: 1;
		}
		ul {
			list-style: none;
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			font-weight: $bold;
		}
		li {
			z-index: 0;
		}
	}
</style>
